// autogenerated

#import "SVGKit+DOM.h"

BOOL SKScanArray(NSScanner* scanner, NSArray** ptr, 
                 BOOL (*SKScanFN)(NSScanner*, id*), NSArray* valid) {
  NSUInteger location = scanner.scanLocation;
  NSMutableArray *array = [[[NSMutableArray alloc] init] autorelease];
  BOOL first = YES;
  while (true) {
    NSUInteger location = scanner.scanLocation;
    if (!first && !SKScanSeparator(scanner, nil)) {
        break;
    }
    first = NO;
    SKScanWhitespaces(scanner, nil);
    id object;
    if (SKScanFN(scanner, &object)) {
        [array addObject:(id)object];
        continue;
    }
    [scanner setScanLocation:location];
    break;
  }
  BOOL success = NO;
  if (valid && [valid count] > 0) {
    for (NSNumber *number in valid) {
      if ([array count] == [number intValue]) {
        success = YES;
        break;
      }
    }
  }
  else success = YES;
  if (success) {
    *ptr = array;
    return YES;
  }
  scanner.scanLocation = location;
  return NO;
}

// All literals in SVG specification.
NSString* SKLiteralString[SKUndefined] = { {% for lit in literals %}
  @"{{ lit }}",{% endfor %}
};

BOOL SKScanLiteral(NSScanner* scanner, SKLiteral* ptr, SKLiteral* valid) {
  NSUInteger location = scanner.scanLocation;
  SKScanWhitespaces(scanner, nil);
  int i = 0;
  while(valid[i] != SKUndefined) {
    NSString *s = SKLiteralString[valid[i]];
    if ([scanner scanString:s intoString:nil]) {
      *ptr = valid[i];
      return YES;
    }
    i++;
  }
  scanner.scanLocation = location;
  return NO;
}
{% for ltype in ltypes %}
SKLiteral {{ltype.astr()}}[] = {
  {% for literal in ltype.literals %}{{literal.cstr()}},{% endfor %}
};

BOOL {{ltype.fstr()}}(NSScanner* scanner, SKLiteral* ptr) {
  return SKScanLiteral(scanner, ptr, {{ltype.astr()}});
}
{% endfor %}

{% for ctype in ctypes %}// {{ctype.tstr()}}
@implementation {{ctype.tstr()}}
{% for ivar in ctype.ivars() %}@synthesize {{ivar.name}};
{% endfor %}
- (id)init {
  self = [super init];
  if (self) { {% for ivar in ctype.ivars() %}{% if ivar.dstr() %}
    {{ivar.name}} = {{ivar.dstr()}};{% endif %}{% endfor %}
  }
  return self;
}

- (void)dealloc { {% for ivar in ctype.ivars() %}{% if ivar.ptr() %}
  {{ivar.name}} = nil;{% endif %}{% endfor %}
  [super dealloc];
}

@end

BOOL {{ctype.fstr()}}(NSScanner* scanner, {{ctype.tstr()}}** ptr) {
  NSUInteger location = scanner.scanLocation;
  {% for branch in ctype.branches %}{
    {{ctype.tstr()}}* result = [[{{ctype.tstr()}} new] autorelease];
    NSUInteger location = scanner.scanLocation;
    {{ branch }}
    if ({{branch.bstr()}}) {
      *ptr = result;
      return YES;
    }
    scanner.scanLocation = location;
  }
  {% endfor %}scanner.scanLocation = location;
  return NO;
}

// Scan indeterminate sized array
BOOL {{ctype.fstr()}}Array(NSScanner* scanner, NSArray** ptr) {
  return SKScanArray(scanner, ptr, {{ctype.fstr()}}, NULL);
}

{% endfor %}

BOOL SKScanString(NSScanner *scanner, NSString **ptr)
{
    NSCharacterSet *characterSet = 
    [[NSCharacterSet characterSetWithCharactersInString:@", 	"] invertedSet];
    NSString* value;
    if ([scanner scanCharactersFromSet:characterSet intoString:&value]) {
        *ptr = value;
        return YES;
    }
    return NO;
}

BOOL SKScanStringArray(NSScanner* scanner, NSArray** ptr) {
  return SKScanArray(scanner, ptr, SKScanString, NULL);
}

BOOL SKScanWhitespaces(NSScanner* scanner, NSString** ptr)
{
  return [scanner scanCharactersFromSet:
          [NSCharacterSet whitespaceCharacterSet] 
                             intoString:ptr];
}
BOOL SKScanSeparator(NSScanner *scanner, NSString** ptr)
{
  NSUInteger location = [scanner scanLocation];
  NSString *wsp = @"";
  BOOL w = SKScanWhitespaces(scanner, &wsp);
  NSString *cma = @"";
  BOOL c = [scanner scanString:@"," intoString:&cma];
  if (w || c) {
    if (ptr) {
        *ptr = [NSString stringWithFormat:@"%@%@", wsp, cma];
    }
    return YES;
  }
  [scanner setScanLocation:location];
  return NO;
}
BOOL SKScanNumber(NSScanner* scanner, NSNumber** num)
{
  double value;
  SKScanWhitespaces(scanner, nil);
  BOOL s = [scanner scanDouble:&value];
  if (s) {
    *num = [NSNumber numberWithDouble:value];
  }
  return s;
}

BOOL SKScanNumberArray(NSScanner* scanner, NSArray** ptr) {
  return SKScanArray(scanner, ptr, SKScanNumber, NULL);
}

BOOL SKScanDouble(NSScanner* scanner, double* value)
{
    SKScanWhitespaces(scanner, nil);
    return [scanner scanDouble:value];
}
